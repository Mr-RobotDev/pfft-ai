"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[523],{3523:function(e,t,l){var r=l(5893),a=l(7294),o=l(1163),i=l(6664),n=l(3299),s=l(3620),x=l(5905),d=l(1852);let p=()=>{let e=(0,d.useMediaQuery)({maxWidth:300}),t=(0,d.useMediaQuery)({minWidth:301,maxWidth:375}),l=(0,d.useMediaQuery)({minWidth:376,maxWidth:425}),r=(0,d.useMediaQuery)({minWidth:426,maxWidth:768}),o=e?"12px":t?"14px":l?"16px":r?"18px":"22px",i=e?"12px":t?"14px":l?"16px":r?"18px":"22px",n=(0,a.useMemo)(()=>({style:{base:{color:"#424770",fontFamily:"Source Code Pro, monospace",fontSize:o,"::placeholder":{color:"#AAB7C4",fontSize:i},":focus":{border:"1px solid #FF854A"}},invalid:{color:"#9E2146"}}}),[o,i]);return n},u=e=>{var t;let{orderNo:l,toPay:d,credit:u}=e,c=(0,o.useRouter)(),m=(0,n.useSession)().data,h=(0,i.useStripe)(),[f,b]=(0,a.useState)(!1),g=(0,i.useElements)(),y=p(),[v,N]=(0,a.useState)(!0),[w,P]=(0,a.useState)(!0),[j,C]=(0,a.useState)(!0),S=e=>{N(e.empty)},E=e=>{C(e.empty)},k=e=>{P(e.empty)},F=async(e,t,r,a,o)=>{await fetch("/api/savePaymentHistory",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:e,customer_id:t,transaction_id:r,expires:a,created:o,orderNo:l,paid:parseFloat(d),credit:parseFloat(u)})})},_=async()=>{try{var e;await fetch("/api/updateUserCredit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userID:null==m?void 0:null===(e=m.user)||void 0===e?void 0:e._id,credit:u})});return}catch(e){console.error(e)}},Z=async()=>{var e;let t={body:{},URL:"/api/getsubscriptionDetails?userID=".concat(null==m?void 0:null===(e=m.user)||void 0===e?void 0:e._id),method:"GET"};try{return await (0,x.Z)(t)}catch(e){console.error(e)}},B=async e=>{e.preventDefault(),h&&g&&(b(!0),Z().then(async t=>{var l,r,a,o,i,n,x,p;if(t){let i=new Date().toLocaleDateString(),n=t.expiry,x=new Date(i),p=new Date(n);if(x>p)try{let t=e.target,i=t.querySelector("#firstName"),n=t.querySelector("#lastName"),x=(null==i?void 0:i.value)+" "+(null==n?void 0:n.value),p=null==m?void 0:null===(l=m.user)||void 0===l?void 0:l.email,u=g.getElement("cardNumber"),f=await h.createPaymentMethod({type:"card",card:u,billing_details:{name:x,email:p}}),y=await fetch("/api/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:x,email:p,toPay:d,paymentMethod:null==f?void 0:null===(r=f.paymentMethod)||void 0===r?void 0:r.id})});if(!y.ok)return b(!1),(0,s.Z)("Payment unsuccessful!");let v=await y.json(),N=await h.confirmCardPayment(v.clientSecret);if(N.error)return b(!1),(0,s.Z)("Payment unsuccessful!");_(),await F(null==m?void 0:null===(a=m.user)||void 0===a?void 0:a._id,v.customer,null==N?void 0:null===(o=N.paymentIntent)||void 0===o?void 0:o.id,v.expires,N.paymentIntent.created),b(!1),(0,s.Z)("Payment Successful! Subscription active."),c.push("/account")}catch(e){console.error(e),b(!1),(0,s.Z)("Payment failed! ")}else x<p&&(0,s.Z)("You are currently on Subscription. Please wait for expiry")}else{let t=e.target,l=t.querySelector("#firstName"),r=t.querySelector("#lastName"),a=(null==l?void 0:l.value)+" "+(null==r?void 0:r.value),o=null==m?void 0:null===(i=m.user)||void 0===i?void 0:i.email,u=g.getElement("cardNumber"),f=await h.createPaymentMethod({type:"card",card:u,billing_details:{name:a,email:o}}),y=await fetch("/api/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:a,email:o,toPay:d,paymentMethod:null==f?void 0:null===(n=f.paymentMethod)||void 0===n?void 0:n.id})});if(!y.ok)return b(!1),(0,s.Z)("Payment unsuccessful!");let v=await y.json(),N=await h.confirmCardPayment(v.clientSecret);if(N.error)return b(!1),(0,s.Z)("Payment unsuccessful!");_(),F(null==m?void 0:null===(x=m.user)||void 0===x?void 0:x._id,v.customer,null==N?void 0:null===(p=N.paymentIntent)||void 0===p?void 0:p.id,v.expires,N.paymentIntent.created),(0,s.Z)("Payment Successful! Subscription active."),b(!1),c.push("/account")}return null}).catch(e=>{b(!1),console.error("Error fetching subscription details:",e)}))};return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("form",{onSubmit:B,className:"w-auto",children:[(0,r.jsxs)("div",{className:"grid-rows-1 lg:grid-cols-2 lg:grid lg:gap-3",children:[(0,r.jsxs)("div",{className:"row-span-1 lg:col-span-1  relative mt-7 mb-5 lg:mb-[1.25rem] w-full",children:[(0,r.jsx)("input",{type:"text",id:"firstName",className:"   w-full px-4 pt-2 h-[32px] font-light placeholder-gray-400 rounded-xl border-[1px] border-[#BEBCBC]  focus:outline-none focus:ring-0 font-courierPrime text-sm   xms:px-7  xms:h-[40px] xms:text-[18px]   xl:h-[72px] xl:text-[20px]   ",placeholder:"First Name",autoComplete:"off",required:!0}),(0,r.jsx)("label",{htmlFor:"firstName",className:"   floating-label  font-extrabold absolute left-4 -top-4 px-4 bg-white text-black-100 transition-all duration-200 pointer-events-none font-courierPrime text-[16px]   xms:text-[20px]  xl:text-[24px] xxs:text-[15px]",children:"First Name"})]}),(0,r.jsxs)("div",{className:"row-span-1 lg:col-span-1 relative mt-7 mb-5 lg:mb-[1.25rem] w-full",children:[(0,r.jsx)("input",{type:"text",id:"lastName",className:"   w-full px-4 pt-2 h-[32px] font-light placeholder-gray-400 rounded-xl border-[1px] border-[#BEBCBC]  focus:outline-none focus:ring-0 font-courierPrime text-sm   xms:px-7  xms:h-[40px] xms:text-[18px]   xl:h-[72px] xl:text-[20px]   ",placeholder:"Last Name",autoComplete:"off",required:!0}),(0,r.jsx)("label",{htmlFor:"lastName",className:"   floating-label  font-extrabold absolute left-4 -top-4 px-4 bg-white text-black-100 transition-all duration-200 pointer-events-none font-courierPrime text-[16px]    xms:text-[20px]  xl:text-[24px] xxs:text-[15px]",children:"Last Name"})]})]}),(0,r.jsxs)("div",{className:"relative mt-7 mb-5 lg:mb-[1.25rem] w-full",children:[(0,r.jsx)("label",{htmlFor:"cardNumber",className:"floating-label  font-extrabold absolute left-4 -top-4  bg-white text-black-100 transition-all duration-200 pointer-events-none font-courierPrime text-[16px]   xms:text-[20px] xl:text-[24px] px-4 xxs:text-[15px]",children:"Card Holder Number"}),(0,r.jsx)(i.CardNumberElement,{id:"cardNumber",options:y,onChange:S,className:"w-full px-4 lg:pt-[0.8rem] pt-3 md:pt-3 xl:pt-7 h-[42px] font-light placeholder-gray-400 rounded-xl border border-gray-500 focus:outline-none focus:ring-0 text-[12px] font-courierPrime   xms:px-7 xms:h-[40px] xms:text-[18px]   xl:h-[72px] xl:text-[24px] py-5 sm:text-[12px]"})]}),(0,r.jsxs)("div",{className:"grid-rows-1 lg:grid-cols-2 lg:grid lg:gap-3",children:[(0,r.jsxs)("div",{className:"relative mt-7  mb-5 lg:mb-[1.25rem] w-full",children:[(0,r.jsx)("label",{htmlFor:"cvc",className:"floating-label font-extrabold absolute left-4 -top-4 px-4 bg-white text-black-100 transition-all duration-200 pointer-events-none font-courierPrime text-[16px]   xms:text-[20px] xl:text-[24px] xxs:text-[15px] ",children:"CVC Number"}),(0,r.jsx)(i.CardCvcElement,{id:"cvc",options:y,onChange:k,className:"w-full px-4 lg:pt-[0.8rem] pt-3 md:pt-3 xl:pt-7 h-[42px] font-light placeholder-gray-400 rounded-xl border border-gray-500 focus:outline-none focus:ring-0 text-[16px] font-courierPrime   xms:px-7 xms:h-[40px] xms:text-[18px]   xl:h-[72px] xl:text-[24px] py-5"})]}),(0,r.jsxs)("div",{className:"relative mt-7 mb-5 lg:mb-[1.25rem]w-full",children:[(0,r.jsx)("label",{htmlFor:"expiryDate",className:"floating-label font-extrabold absolute left-4 -top-4 px-4 bg-white text-black-100 transition-all duration-200 pointer-events-none font-courierPrime text-[16px]   xms:text-[20px] xl:text-[24px] xxs:text-[15px]",children:"Expiry Date"}),(0,r.jsx)(i.CardExpiryElement,{id:"expiryDate",options:y,onChange:E,className:"w-full px-4 lg:pt-[0.8rem] pt-3 md:pt-3 xl:pt-7 h-[42px] font-light placeholder-gray-400 rounded-xl border border-gray-500 focus:outline-none focus:ring-0 text-[16px] font-courierPrime   xms:px-7 xms:h-[40px] xms:text-[18px]   xl:h-[72px] xl:text-[24px] py-5"})]})]}),(0,r.jsxs)("div",{className:"relative mt-7 mb-5 lg:mb-[1.75rem] w-full",children:[(0,r.jsx)("input",{type:"email",id:"email",disabled:!0,className:"   w-full px-4 xl:pt-2 lg:pt-[0.5rem] h-[44px]   font-light placeholder-gray-400 rounded-xl border border-[#BEBCBC] focus:outline-none focus:ring-0 font-courierPrime text-sm lg:h-[44px]   xms:px-7  xms:h-[40px] xms:text-[18px]   xl:h-[72px] xl:text-[24px]",placeholder:"johndoe@gmail.com",autoComplete:"off",value:null==m?void 0:null===(t=m.user)||void 0===t?void 0:t.email}),(0,r.jsx)("label",{htmlFor:"email",className:"   floating-label font-extrabold absolute left-4 -top-4 px-4 bg-white text-black-100 transition-all duration-200 pointer-events-none font-courierPrime text-[16px] placeholder-black-100   xms:text-[20px]  xl:text-[24px] xxs:text-[15px]",children:"Email Address"})]}),(0,r.jsx)("button",{type:"submit",disabled:!h||f||w||j||v,className:" rounded-3xl bg-gradient-to-r from-orange-100 to-orange-200  w-full py-2 lg:py-4 text-slate-50 font-courier-prime text-[18px] font-courierPrime    ",children:"Pay Now"}),(0,r.jsx)("span",{className:"text-[red]",children:f?"Please wait while we process your request":""})]})})};t.Z=u},5905:function(e,t){async function l(e){let{body:t,URL:l,method:r}=e,a={method:r,headers:{"Content-Type":"application/json"}};a="GET"===r?{...a,method:r}:{...a,method:r,body:JSON.stringify(t)};try{let e=await fetch(l,a),t=await e.json();return t}catch(e){console.error(e)}}t.Z=l},3620:function(e,t,l){var r=l(2920);l(1399);let a=async e=>(0,r.Am)(e,{position:"top-right",autoClose:3e3,hideProgressBar:!0,closeOnClick:!0,pauseOnHover:!0,draggable:!1,progress:void 0,theme:"light"});t.Z=a}}]);